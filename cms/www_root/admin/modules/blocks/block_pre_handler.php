<?php	// No direct access	defined('_ACCESS') or die;		require_once FRONTEND_REQUEST . "view/request_handlers/module_request_handler.php";	require_once FRONTEND_REQUEST . "database/dao/block_dao.php";	require_once FRONTEND_REQUEST . "database/dao/element_dao.php";	require_once FRONTEND_REQUEST . "modules/blocks/block_form.php";		class BlockPreHandler extends ModuleRequestHandler {		private static $BLOCK_ID_POST = "element_holder_id";		private static $BLOCK_ID_GET = "block";		private $_block_dao;		private $_element_dao;		private $_current_block;				public function __construct() {			$this->_block_dao = BlockDao::getInstance();			$this->_element_dao = ElementDao::getInstance();		}				public function handleGet() {			$this->_current_block = $this->getBlockFromGetRequest();		}				public function handlePost() {			$this->_current_block = $this->getBlockFromPostRequest();			if ($this->isUpdateBlockAction())				$this->updateBlock();		}				public function getCurrentBlock() {			return $this->_current_block;		}				private function updateBlock() {			$block_form = new BlockForm($this->_current_block);			try {				$block_form->loadFields();				$this->_element_dao->updateElementOrder($block_form->getElementOrder(), $this->_current_block);				$this->_block_dao->updateBlock($this->_current_block);				Notifications::setSuccessMessage("Blok succesvol opgeslagen");			} catch (FormException $e) {				Notifications::setFailedMessage("Blok niet opgeslagen, verwerk de fouten");			}		}				private function getBlockFromGetRequest() {			if (isset($_GET[self::$BLOCK_ID_GET]))				return $this->getBlockFromDatabase($_GET[self::$BLOCK_ID_GET]);		}				private function getBlockFromPostRequest() {			if (isset($_POST[self::$BLOCK_ID_POST]))				return $this->getBlockFromDatabase($_POST[self::$BLOCK_ID_POST]);		}				private function getBlockFromDatabase($block_id) {				return $this->_block_dao->getBlock($block_id);		}				private function isUpdateBlockAction() {			return isset($_POST["action"]) && isset($_POST["action"]) == "update_element_holder";		}	}	?>